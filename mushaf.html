<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Mushaf Ayat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #fefcf8;
      padding: 1em;
      font-family: sans-serif;
      direction: rtl;
    }

    h2 { text-align: center; }

    .controls {
      direction: ltr;
      max-width: 720px;
      margin: auto;
      display: flex;
      flex-wrap: wrap;
      gap: 1em;
      justify-content: center;
      align-items: flex-end;
    }

    label {
      font-size: 0.9em;
    }

    select {
      font-size: 1em;
      padding: 0.5em;
    }

    .page-container {
      font-size: 2.5em;
      line-height: 1.6;
      text-align: justify;
      user-select: text;
      margin: 2em auto;
      opacity: 0;
      transition: opacity 0.3s ease;
      display: none;
      word-spacing: 0.2em;
      max-width: 700px;
    }

    .word {
      display: inline-block;
      position: relative;
      margin: 0 0.1em;
      cursor: pointer;
    }

    .word:hover {
      background-color: #f7eacb;
      border-radius: 6px;
    }

    .translation {
      position: absolute;
      bottom: -2.4em;
      font-size: 0.45em;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 0.3em 0.6em;
      white-space: nowrap;
      display: none;
      z-index: 10;
      color: #444;
    }

    .word.active .translation {
      display: block;
    }

    @media (max-width: 768px) {
      .page-container { font-size: 1.5em; }
    }
  </style>
</head>
<body>

<h2>ğŸ“– Al-Qur'an Dinamis</h2>

<div class="controls">
  <label>Surah
    <select id="surahSelect"></select>
  </label>
  <label>Ayat
    <select id="ayahSelect"></select>
  </label>
  <label>Jumlah Kata
    <select id="wordCount">
      <option value="0">Semua</option>
    </select>
  </label>
</div>

<div id="pages"></div>

<script>
const surahList = {
  1:["Al-FÄtiá¸¥ah",7], 2:["Al-Baqarah",286], 3:["Ä€l Ê¿ImrÄn",200], 4:["An-NisÄÊ¾",176],
  5:["Al-MÄÊ¾idah",120], 6:["Al-AnÊ¿Äm",165], 7:["Al-AÊ¿rÄf",206], 8:["Al-AnfÄl",75],
  9:["At-Tawbah",129], 10:["YÅ«nus",109], 11:["HÅ«d",123], 12:["YÅ«suf",111], 13:["Ar-RaÊ¿d",43],
  14:["IbrÄhÄ«m",52], 15:["Al-á¸¤ijr",99], 16:["An-Naá¸¥l",128], 17:["Al-IsrÄÊ¾",111],
  18:["Al-Kahf",110], 19:["Maryam",98], 20:["á¹¬Ä-HÄ",135], 21:["Al-AnbiyÄÊ¾",112],
  22:["Al-á¸¤ajj",78], 23:["Al-MuÊ¾minÅ«n",118], 24:["An-NÅ«r",64], 25:["Al-FurqÄn",77],
  26:["Ash-ShuÊ¿arÄÊ¾",227], 27:["An-Naml",93], 28:["Al-Qaá¹£aá¹£",88], 29:["Al-Ê¿AnkabÅ«t",69],
  30:["Ar-RÅ«m",60], 31:["LuqmÄn",34], 32:["As-Sajdah",30], 33:["Al-Aá¸¥zÄb",73],
  34:["SabaÊ¾",54], 35:["FÄá¹­ir",45], 36:["YÄ-SÄ«n",83], 37:["As-á¹¢ÄffÄt",182],
  38:["á¹¢Äd",88], 39:["Az-Zumar",75], 40:["GhÄfir",85], 41:["Fuá¹£á¹£ilat",54], 42:["Ash-ShÅ«rÄ",53],
  43:["Az-Zukhruf",89], 44:["Ad-DukhÄn",59], 45:["Al-JÄthiyah",37], 46:["Al-Aá¸¥qÄf",35],
  47:["Muá¸¥ammad",38], 48:["Al-Fatá¸¥",29], 49:["Al-á¸¤ujurÄt",18], 50:["QÄf",45],
  51:["Adh-DhÄriyÄt",60], 52:["Aá¹­-á¹¬Å«r",49], 53:["An-Najm",62], 54:["Al-Qamar",55],
  55:["Ar-Raá¸¥mÄn",78], 56:["Al-WÄqiÊ¿ah",96], 57:["Al-á¸¤adÄ«d",29], 58:["Al-MujÄdilah",22],
  59:["Al-á¸¤ashr",24], 60:["Al-Mumtaá¸¥anah",13], 61:["Aá¹£-á¹¢aff",14], 62:["Al-JumuÊ¿ah",11],
  63:["Al-MunÄfiqÅ«n",11], 64:["At-TaghÄbun",18], 65:["Aá¹­-á¹¬alÄq",12], 66:["At-Taá¸¥rÄ«m",12],
  67:["Al-Mulk",30], 68:["Al-Qalam",52], 69:["Al-á¸¤Äqqah",52], 70:["Al-MaÊ¿Ärij",44],
  71:["NÅ«á¸¥",28], 72:["Al-Jinn",28], 73:["Al-Muzzammil",20], 74:["Al-Muddaththir",56],
  75:["Al-QiyÄmah",40], 76:["Al-InsÄn",31], 77:["Al-MursalÄt",50], 78:["An-NabaÊ¾",40],
  79:["An-NÄziÊ¿Ät",46], 80:["Ê¿Abasa",42], 81:["At-TakwÄ«r",29], 82:["Al-Infiá¹­Är",19],
  83:["Al-Muá¹­affifÄ«n",36], 84:["Al-InshiqÄq",25], 85:["Al-BurÅ«j",22], 86:["Aá¹­-á¹¬Äriq",17],
  87:["Al-AÊ¿lÄ",19], 88:["Al-GhÄshiyah",26], 89:["Al-Fajr",30], 90:["Al-Balad",20],
  91:["Ash-Shams",15], 92:["Al-Layl",21], 93:["Aá¸-á¸Œuá¸¥Ä",11], 94:["Ash-Shará¸¥",8],
  95:["At-TÄ«n",8], 96:["Al-Ê¿Alaq",19], 97:["Al-Qadr",5], 98:["Al-Bayyinah",8],
  99:["Az-Zalzalah",8], 100:["Al-Ê¿Ä€diyÄt",11], 101:["Al-QÄriÊ¿ah",11], 102:["At-TakÄthur",8],
  103:["Al-Ê¿Aá¹£r",3], 104:["Al-Humazah",9], 105:["Al-FÄ«l",5], 106:["Quraysh",4],
  107:["Al-MÄÊ¿Å«n",7], 108:["Al-Kawthar",3], 109:["Al-KÄfirÅ«n",6], 110:["An-Naá¹£r",3],
  111:["Al-Masad",5], 112:["Al-IkhlÄá¹£",4], 113:["Al-Falaq",5], 114:["An-NÄs",6]
};

const surahSelect = document.getElementById("surahSelect");
const ayahSelect = document.getElementById("ayahSelect");
const wordCount = document.getElementById("wordCount");

for (let i = 1; i <= 114; i++) {
  const [name, count] = surahList[i];
  const opt = new Option(`${i}. ${name} (${count})`, i);
  opt.dataset.count = count;
  surahSelect.appendChild(opt);
}
for (let i = 1; i <= 129; i++) {
  wordCount.appendChild(new Option(i, i));
}
surahSelect.addEventListener("change", updateAyahDropdown);
ayahSelect.addEventListener("change", loadAyat);
wordCount.addEventListener("change", loadAyat);

function updateAyahDropdown() {
  const max = surahSelect.options[surahSelect.selectedIndex].dataset.count;
  ayahSelect.innerHTML = "";
  for (let i = 1; i <= max; i++) {
    ayahSelect.appendChild(new Option(i, i));
  }
  ayahSelect.value = 1;
  loadAyat();
}
async function loadAyat() {
  const s = surahSelect.value;
  const a = ayahSelect.value;
  const wc = +wordCount.value;
  const key = `${s}:${a}`;
  const container = document.getElementById("pages");
  container.innerHTML = "";

  const pageMap = await fetch("https://raw.githubusercontent.com/dickymiswardi/tadabbur/main/ayah_page_map.json").then(r => r.json());
  const page = pageMap[key];
  const fontName = `QCF_P${String(page).padStart(3, '0')}`;
  const fontUrl = `https://cdn.jsdelivr.net/gh/dickymiswardi/quran/fonts/${fontName}.TTF`;

  const style = document.createElement("style");
  style.textContent = `@font-face {
    font-family: '${fontName}';
    src: url('${fontUrl}') format('truetype');
  }`;
  document.head.appendChild(style);

  const div = document.createElement("div");
  div.className = "page-container";
  div.style.fontFamily = fontName;
  container.appendChild(div);

  await document.fonts.load(`1em ${fontName}`);
  const data = await fetch(`https://api.quran.com/api/v4/verses/by_key/${key}?words=true&language=id&translations=33`).then(r => r.json());
  const line = document.createElement("div");

  data.verse.words.slice(0, wc || undefined).forEach(word => {
    const span = document.createElement("span");
    span.className = "word";
    span.innerText = word.code_v1 || word.text;
    const trans = document.createElement("div");
    trans.className = "translation";
    trans.innerText = word.translation?.text || "-";
    span.appendChild(trans);
    span.onclick = () => {
      document.querySelectorAll(".word").forEach(w => w.classList.remove("active"));
      span.classList.add("active");
      setTimeout(() => span.classList.remove("active"), 5000);
    };
    line.appendChild(span);
    line.appendChild(document.createTextNode(" "));
  });

  div.appendChild(line);
  div.style.display = "block";
  requestAnimationFrame(() => div.style.opacity = "1");
}

surahSelect.value = 1;
updateAyahDropdown(); // initial render
</script>

</body>
</html>

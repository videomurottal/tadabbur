<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Mushaf Otomatis</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #fefcf8;
      padding: 1em;
      font-family: sans-serif;
      direction: rtl;
    }

    h2 { text-align: center; }

    .controls {
      direction: ltr;
      max-width: 720px;
      margin: auto;
      display: flex;
      flex-wrap: wrap;
      gap: 1em;
      justify-content: center;
      align-items: flex-end;
    }

    .controls label {
      display: flex;
      flex-direction: column;
      font-size: 0.9em;
    }

    select, input {
      font-size: 1em;
      padding: 0.3em;
    }

    button {
      font-size: 1em;
      padding: 0.5em 1.2em;
      cursor: pointer;
    }

    .page-container {
      font-size: 2.5em;
      line-height: 1.6;
      text-align: justify;
      user-select: text;
      margin: 2em auto;
      opacity: 0;
      transition: opacity 0.3s ease;
      display: none;
      word-spacing: 0.2em;
      max-width: 700px;
    }

    .word {
      display: inline-block;
      position: relative;
      margin: 0 0.1em;
      cursor: pointer;
    }

    .word:hover {
      background-color: #f7eacb;
      border-radius: 6px;
    }

    .translation {
      position: absolute;
      bottom: -2.4em;
      font-size: 0.45em;
      font-family: sans-serif;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 0.3em 0.6em;
      white-space: nowrap;
      display: none;
      z-index: 10;
      color: #444;
    }

    .word.active .translation {
      display: block;
    }

    @media (max-width: 768px) {
      .page-container { font-size: 1.5em; }
    }
  </style>
</head>
<body>

<h2 id="title">ğŸ“– Al-Qur'an Dinamis</h2>

<div class="controls">
  <label>Surah Awal
    <select id="fromSurah" onchange="updateAyahInput(this, 'fromAyah')"></select>
  </label>
  <label>Ayat Awal
    <input id="fromAyah" type="number" min="1" value="1">
  </label>
  <label>Surah Akhir
    <select id="toSurah" onchange="updateAyahInput(this, 'toAyah')"></select>
  </label>
  <label>Ayat Akhir
    <input id="toAyah" type="number" min="1" value="7">
  </label>
  <button onclick="renderAyat()">ğŸ“¥ Tampilkan Ayat</button>
</div>

<div id="pages"></div>

<script>
const surahList = {
  1:["Al-FÄtiá¸¥ah",7], 2:["Al-Baqarah",286], 3:["Ä€l Ê¿ImrÄn",200], 4:["An-NisÄÊ¾",176], 5:["Al-MÄÊ¾idah",120],
  6:["Al-AnÊ¿Äm",165], 7:["Al-AÊ¿rÄf",206], 8:["Al-AnfÄl",75], 9:["At-Tawbah",129], 10:["YÅ«nus",109],
  11:["HÅ«d",123], 12:["YÅ«suf",111], 13:["Ar-RaÊ¿d",43], 14:["IbrÄhÄ«m",52], 15:["Al-á¸¤ijr",99],
  16:["An-Naá¸¥l",128], 17:["Al-IsrÄÊ¾",111], 18:["Al-Kahf",110], 19:["Maryam",98], 20:["á¹¬Ä-HÄ",135],
  21:["Al-AnbiyÄÊ¾",112], 22:["Al-á¸¤ajj",78], 23:["Al-MuÊ¾minÅ«n",118], 24:["An-NÅ«r",64], 25:["Al-FurqÄn",77],
  26:["Ash-ShuÊ¿arÄÊ¾",227], 27:["An-Naml",93], 28:["Al-Qaá¹£aá¹£",88], 29:["Al-Ê¿AnkabÅ«t",69], 30:["Ar-RÅ«m",60],
  31:["LuqmÄn",34], 32:["As-Sajdah",30], 33:["Al-Aá¸¥zÄb",73], 34:["SabaÊ¾",54], 35:["FÄá¹­ir",45],
  36:["YÄ-SÄ«n",83], 37:["As-á¹¢ÄffÄt",182], 38:["á¹¢Äd",88], 39:["Az-Zumar",75], 40:["GhÄfir",85],
  41:["Fuá¹£á¹£ilat",54], 42:["Ash-ShÅ«rÄ",53], 43:["Az-Zukhruf",89], 44:["Ad-DukhÄn",59], 45:["Al-JÄthiyah",37],
  46:["Al-Aá¸¥qÄf",35], 47:["Muá¸¥ammad",38], 48:["Al-Fatá¸¥",29], 49:["Al-á¸¤ujurÄt",18], 50:["QÄf",45],
  51:["Adh-DhÄriyÄt",60], 52:["Aá¹­-á¹¬Å«r",49], 53:["An-Najm",62], 54:["Al-Qamar",55], 55:["Ar-Raá¸¥mÄn",78],
  56:["Al-WÄqiÊ¿ah",96], 57:["Al-á¸¤adÄ«d",29], 58:["Al-MujÄdilah",22], 59:["Al-á¸¤ashr",24], 60:["Al-Mumtaá¸¥anah",13],
  61:["Aá¹£-á¹¢aff",14], 62:["Al-JumuÊ¿ah",11], 63:["Al-MunÄfiqÅ«n",11], 64:["At-TaghÄbun",18],
  65:["Aá¹­-á¹¬alÄq",12], 66:["At-Taá¸¥rÄ«m",12], 67:["Al-Mulk",30], 68:["Al-Qalam",52], 69:["Al-á¸¤Äqqah",52],
  70:["Al-MaÊ¿Ärij",44], 71:["NÅ«á¸¥",28], 72:["Al-Jinn",28], 73:["Al-Muzzammil",20], 74:["Al-Muddaththir",56],
  75:["Al-QiyÄmah",40], 76:["Al-InsÄn",31], 77:["Al-MursalÄt",50], 78:["An-NabaÊ¾",40], 79:["An-NÄziÊ¿Ät",46],
  80:["Ê¿Abasa",42], 81:["At-TakwÄ«r",29], 82:["Al-Infiá¹­Är",19], 83:["Al-Muá¹­affifÄ«n",36], 84:["Al-InshiqÄq",25],
  85:["Al-BurÅ«j",22], 86:["Aá¹­-á¹¬Äriq",17], 87:["Al-AÊ¿lÄ",19], 88:["Al-GhÄshiyah",26], 89:["Al-Fajr",30],
  90:["Al-Balad",20], 91:["Ash-Shams",15], 92:["Al-Layl",21], 93:["Aá¸-á¸Œuá¸¥Ä",11], 94:["Ash-Shará¸¥",8],
  95:["At-TÄ«n",8], 96:["Al-Ê¿Alaq",19], 97:["Al-Qadr",5], 98:["Al-Bayyinah",8], 99:["Az-Zalzalah",8],
  100:["Al-Ê¿Ä€diyÄt",11], 101:["Al-QÄriÊ¿ah",11], 102:["At-TakÄthur",8], 103:["Al-Ê¿Aá¹£r",3],
  104:["Al-Humazah",9], 105:["Al-FÄ«l",5], 106:["Quraysh",4], 107:["Al-MÄÊ¿Å«n",7], 108:["Al-Kawthar",3],
  109:["Al-KÄfirÅ«n",6], 110:["An-Naá¹£r",3], 111:["Al-Masad",5], 112:["Al-IkhlÄá¹£",4], 113:["Al-Falaq",5],
  114:["An-NÄs",6]
};

function populateDropdowns() {
  const from = document.getElementById("fromSurah");
  const to = document.getElementById("toSurah");
  for (let i = 1; i <= 114; i++) {
    const [name, jml] = surahList[i];
    const opt = new Option(`${i}. ${name} (${jml})`, i);
    opt.dataset.jml = jml;
    from.appendChild(opt.cloneNode(true));
    to.appendChild(opt.cloneNode(true));
  }
  from.value = 1;
  to.value = 2;
}
populateDropdowns();

function updateAyahInput(sel, inputId) {
  const jml = sel.options[sel.selectedIndex].dataset.jml;
  const input = document.getElementById(inputId);
  input.max = jml;
  if (input.value > jml) input.value = jml;
}

function generateAyahKeys(fromS, fromA, toS, toA) {
  const keys = [];
  for (let s = fromS; s <= toS; s++) {
    const start = s == fromS ? fromA : 1;
    const end = s == toS ? toA : surahList[s][1];
    for (let i = start; i <= end; i++) {
      keys.push(`${s}:${i}`);
    }
  }
  return keys;
}

async function renderAyat() {
  document.getElementById("pages").innerHTML = "";

  const fromSurah = +document.getElementById("fromSurah").value;
  const fromAyah = +document.getElementById("fromAyah").value;
  const toSurah = +document.getElementById("toSurah").value;
  const toAyah = +document.getElementById("toAyah").value;

  const ayahKeys = generateAyahKeys(fromSurah, fromAyah, toSurah, toAyah);

  const pageMap = await fetch("https://raw.githubusercontent.com/dickymiswardi/tadabbur/refs/heads/main/ayah_page_map.json").then(r => r.json());

  const pages = {};
  ayahKeys.forEach(key => {
    const page = pageMap[key];
    if (!pages[page]) pages[page] = [];
    pages[page].push(key);
  });

  for (const [page, keys] of Object.entries(pages)) {
    const fontName = `QCF_P${String(page).padStart(3, '0')}`;
    const fontUrl = `https://cdn.jsdelivr.net/gh/dickymiswardi/quran/fonts/${fontName}.TTF`;

    const style = document.createElement("style");
    style.textContent = `@font-face {
      font-family: '${fontName}';
      src: url('${fontUrl}') format('truetype');
    }`;
    document.head.appendChild(style);

    const container = document.createElement("div");
    container.className = "page-container";
    container.style.fontFamily = fontName;
    document.getElementById("pages").appendChild(container);

    await document.fonts.load(`1em ${fontName}`);

    const results = await Promise.all(keys.map(k =>
      fetch(`https://api.quran.com/api/v4/verses/by_key/${k}?words=true&language=id&translations=33`)
        .then(r => r.json())
    ));

    results.forEach(data => {
      const line = document.createElement("div");
      data.verse.words.forEach(word => {
        const span = document.createElement("span");
        span.className = "word";
        span.innerText = word.code_v1 || word.text;
        const trans = document.createElement("div");
        trans.className = "translation";
        trans.innerText = word.translation?.text || "-";
        span.appendChild(trans);
        span.addEventListener("click", () => {
          document.querySelectorAll(".word").forEach(w => w.classList.remove("active"));
          span.classList.add("active");
          setTimeout(() => span.classList.remove("active"), 7000);
        });
        line.appendChild(span);
        line.appendChild(document.createTextNode(" "));
      });
      container.appendChild(line);
    });
    container.style.display = "block";
    requestAnimationFrame(() => container.style.opacity = "1");
  }
}
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Poster Quran</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    body {
  background: #fefcf8;
  padding: 1em;
  font-family: sans-serif;
  direction: rtl;
  margin: 0;
}

h2 {
  text-align: center;
  font-size: clamp(1.5rem, 4vw, 2.5rem);
  margin-bottom: 1rem;
}

    .translation[contenteditable="true"] {
  cursor: text;
}

#pages {
  /* ... (sudah ada background properties) */
  filter: contrast(1); /* Default */
  transition: filter 0.3s ease;
}
    
input[type="file"],
input[type="url"],
select,
button {
  font-size: clamp(1rem, 3vw, 1.2rem);
  padding: 0.5em;
  border: 1px solid #ccc;
  border-radius: 6px;
  width: 100%;
  box-sizing: border-box;
}

button {
  background-color: #4cafef;
  color: #fff;
  cursor: pointer;
  transition: background 0.3s ease;
}

button:hover {
  background-color: #007acc;
}

#pages {
  width: 100%;
  max-width: 540px;
  aspect-ratio: 1 / 1;
  margin: 2em auto;
  position: relative;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

.surah-info {
  font-size: 0.4em;
  font-family: sans-serif;
  color: #999;
  margin-top: 0.5em;
  text-align: center;
  direction: ltr;
}

.brand-watermark {
  font-size: 0.4em;
  font-family: sans-serif;
  color: #999;
  position: absolute;     /* â¬…ï¸ Supaya tidak mendorong kotak */
  bottom: 0.5em;           /* â¬…ï¸ Turunkan ke bawah */
  left: 50%;              
  transform: translateX(-50%); /* â¬…ï¸ Tengahkan secara horizontal */
  text-align: center;
  font-style: italic;
  direction: ltr;
  user-select: none;
}

.controls {
  direction: ltr;
  max-width: 800px;
  margin: 0 auto;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 0.8em;
  justify-content: center;
  align-items: center;
  padding: 0.5em;
}

.controls label {
  font-size: clamp(0.85rem, 2.5vw, 1rem);
  display: flex;
  flex-direction: column;
}

/* Quran V1 */
.quran-v1 {
  font-size: clamp(1.8em, 5vw, 2.5em);
  line-height: 1.5;
  word-spacing: 0.2em;
  text-align: center;
  user-select: text;
  margin: 2em auto;
  color: #ffffff;
  opacity: 0;
  transition: opacity 0.3s ease;
  display: none;
  max-width: 80%;
  overflow-wrap: break-word;
}

/* Quran V2 */
.quran-v2 {
  font-size: clamp(1.8em, 5vw, 2.5em);
  line-height: 1.5;
  word-spacing: 0.2em;
  text-align: center;
  user-select: text;
  margin: 2em auto;
  color: #ffffff;
  opacity: 0;
  transition: opacity 0.3s ease;
  display: none;
  max-width: 80%;
  overflow-wrap: break-word;
}

.word {
  display: inline-block;
  margin: 0;
  cursor: default;
}

/* Terjemahan */
.translation {
  font-family: sans-serif;
  font-size: clamp(1rem, 3vw, 1.2rem);
  color: #ffffff;
  direction: ltr;
  text-align: center;
  line-height: 1.4;
  word-spacing: 0.2em;
  margin-top: 0.5em;
  padding: 0 0.5em;
}

    .button-wrapper {
  display: flex;
  align-items: flex-end;
}

@media (max-width: 600px) {
  .controls {
    grid-template-columns: repeat(2, 1fr);
  }
}
  </style>
</head>
<body>

<h2>Poster Quran</h2>
  
<div class="controls">
  <!-- Baris 1: Surah & Ayat -->
  <label><select id="surahSelect"></select>
  </label>
  <label><select id="ayahSelect"></select>
  </label>

  <!-- Baris 2: Dari Kata & Sampai Kata -->
  <label><select id="wordStart"></select>
  </label>
  <label><select id="wordEnd"></select>
  </label>

  <!-- Baris 3: Terjemahan & Tombol Link & Quran V1/V2 -->
  <label><select id="wordTranslationId">
  <option value="">Tanpa Terjemah Ayat</option>
  <option value="indonesian_sabiq">Indonesian â€“ Sabiq</option>
  <option value="33" selected>Indonesian â€“ Islamic Affairs Ministry</option>
      <option value="20">English â€“ Saheeh International</option>
    <option value="qenc:indonesian_sabiq">Indonesian â€“ Sabiq (QuranEnc)</option>
<option value="qenc:indonesian_affairs">Indonesian â€“ Affairs (QuranEnc)</option>
<option value="qenc:indonesian_complex">Indonesian â€“ Complex (QuranEnc)</option>
<option value="qenc:english_rwwad">English â€“ RWWAD (QuranEnc)</option>
<option value="qenc:english_saheeh">English â€“ Saheeh (QuranEnc)</option>
<option value="qenc:english_hilali_khan">English â€“ Hilali Khan (QuranEnc)</option>
<option value="qenc:french_rashid">French â€“ Rashid (QuranEnc)</option>
<option value="qenc:french_montada">French â€“ Montada (QuranEnc)</option>
<option value="qenc:spanish_montada_eu">Spanish â€“ Montada EU (QuranEnc)</option>
<option value="qenc:spanish_garcia">Spanish â€“ Garcia (QuranEnc)</option>
<option value="qenc:spanish_montada_latin">Spanish â€“ Montada Latin (QuranEnc)</option>
<option value="qenc:portuguese_nasr">Portuguese â€“ Nasr (QuranEnc)</option>
<option value="qenc:german_bubenheim">German â€“ Bubenheim (QuranEnc)</option>
<option value="qenc:romanian_project">Romanian â€“ Project (QuranEnc)</option>
<option value="qenc:dutch_center">Dutch â€“ Center (QuranEnc)</option>
<option value="qenc:turkish_rwwad">Turkish â€“ RWWAD (QuranEnc)</option>
<option value="qenc:turkish_shaban">Turkish â€“ Shaban (QuranEnc)</option>
<option value="qenc:turkish_shahin">Turkish â€“ Shahin (QuranEnc)</option>
<option value="qenc:azeri_musayev">Azeri â€“ Musayev (QuranEnc)</option>
<option value="qenc:macedonian_group">Macedonian â€“ Group (QuranEnc)</option>
<option value="qenc:albanian_nahi">Albanian â€“ Nahi (QuranEnc)</option>
<option value="qenc:bosnian_rwwad">Bosnian â€“ RWWAD (QuranEnc)</option>
<option value="qenc:bosnian_mihanovich">Bosnian â€“ Mihanovich (QuranEnc)</option>
<option value="qenc:serbian_rwwad">Serbian â€“ RWWAD (QuranEnc)</option>
<option value="qenc:croatian_rwwad">Croatian â€“ RWWAD (QuranEnc)</option>
<option value="qenc:lithuanian_rwwad">Lithuanian â€“ RWWAD (QuranEnc)</option>
<option value="qenc:uzbek_rwwad">Uzbek â€“ RWWAD (QuranEnc)</option>
<option value="qenc:uzbek_mansour">Uzbek â€“ Mansour (QuranEnc)</option>
<option value="qenc:tajik_arifi">Tajik â€“ Arifi (QuranEnc)</option>
<option value="qenc:kyrgyz_hakimov">Kyrgyz â€“ Hakimov (QuranEnc)</option>
<option value="qenc:tagalog_rwwad">Tagalog â€“ RWWAD (QuranEnc)</option>
<option value="qenc:bisayan_rwwad">Bisayan â€“ RWWAD (QuranEnc)</option>
<option value="qenc:chinese_suliman">Chinese â€“ Suliman (QuranEnc)</option>
<option value="qenc:chinese_makin">Chinese â€“ Makin (QuranEnc)</option>
<option value="qenc:uyghur_saleh">Uyghur â€“ Saleh (QuranEnc)</option>
<option value="qenc:japanese_saeedsato">Japanese â€“ Saeed Sato (QuranEnc)</option>
<option value="qenc:vietnamese_rwwad">Vietnamese â€“ RWWAD (QuranEnc)</option>
<option value="qenc:khmer_rwwad">Khmer â€“ RWWAD (QuranEnc)</option>
<option value="qenc:persian_ih">Persian â€“ IH (QuranEnc)</option>
<option value="qenc:kurdish_bamoki">Kurdish â€“ Bamoki (QuranEnc)</option>
<option value="qenc:pashto_rwwad">Pashto â€“ RWWAD (QuranEnc)</option>
<option value="qenc:urdu_junagarhi">Urdu â€“ Junagarhi (QuranEnc)</option>
<option value="qenc:hindi_omari">Hindi â€“ Omari (QuranEnc)</option>
<option value="qenc:telugu_muhammad">Telugu â€“ Muhammad (QuranEnc)</option>
<option value="qenc:gujarati_omari">Gujarati â€“ Omari (QuranEnc)</option>
<option value="qenc:malayalam_kunhi">Malayalam â€“ Kunhi (QuranEnc)</option>
<option value="qenc:kannada_hamza">Kannada â€“ Hamza (QuranEnc)</option>
<option value="qenc:assamese_rafeeq">Assamese â€“ Rafeeq (QuranEnc)</option>
<option value="qenc:punjabi_arif">Punjabi â€“ Arif (QuranEnc)</option>
<option value="qenc:tamil_omar">Tamil â€“ Omar (QuranEnc)</option>
<option value="qenc:tamil_baqavi">Tamil â€“ Baqavi (QuranEnc)</option>
<option value="qenc:sinhalese_mahir">Sinhalese â€“ Mahir (QuranEnc)</option>
<option value="qenc:swahili_barawani">Swahili â€“ Barawani (QuranEnc)</option>
<option value="qenc:somali_yacob">Somali â€“ Yacob (QuranEnc)</option>
<option value="qenc:amharic_zain">Amharic â€“ Zain (QuranEnc)</option>
<option value="qenc:yoruba_mikail">Yoruba â€“ Mikail (QuranEnc)</option>
<option value="qenc:hausa_gummi">Hausa â€“ Gummi (QuranEnc)</option>
<option value="qenc:oromo_ababor">Oromo â€“ Ababor (QuranEnc)</option>
<option value="qenc:afar_hamza">Afar â€“ Hamza (QuranEnc)</option>
<option value="qenc:ankobambara_dayyan">Ankobambara â€“ Dayyan (QuranEnc)</option>
<option value="qenc:kinyarwanda_assoc">Kinyarwanda â€“ Assoc (QuranEnc)</option>
<option value="qenc:ikirundi_gehiti">Ikirundi â€“ Gehiti (QuranEnc)</option>
<option value="qenc:moore_rwwad">Moore â€“ RWWAD (QuranEnc)</option>
<option value="qenc:asante_harun">Asante â€“ Harun (QuranEnc)</option>
<option value="qenc:lingala_zakaria">Lingala â€“ Zakaria (QuranEnc)</option>
    </select>
  </label>
  <div class="button-wrapper">
  <button id="customLinkButton">Tombol Link</button>
</div>
<div class="button-wrapper">
  <button onclick="setVersion('v1')">Quran V1</button>
</div>
<div class="button-wrapper">
  <button onclick="setVersion('v2')">Quran V2</button>
</div>
</div>


<div id="pages"></div>

<div class="controls">
  <!-- Dropdown Background -->
  <label><select id="backgroundSelect">
      <option value="https://images.pexels.com/photos/1819662/pexels-photo-1819662.jpeg">Wallpaper 1</option>
      <option value="https://images.pexels.com/photos/13861001/pexels-photo-13861001.jpeg">Wallpaper 2</option>
      <option value="https://images.pexels.com/photos/28883533/pexels-photo-28883533.jpeg">Wallpaper 3</option>
      <option value="https://images.pexels.com/photos/18945829/pexels-photo-18945829.jpeg">Wallpaper 4</option>
    </select>
  </label>

  <!-- Upload File -->
  <div class="button-wrapper">
  <button id="uploadTrigger">Upload Gambar</button>
  <input type="file" id="backgroundUpload" accept="image/*" style="display: none;">
</div>

  <!-- Input URL di awal -->
  <div class="button-wrapper">
  <button id="showUrlInput" class="button">Link Gambar</button>
</div>

    <!-- Tombol/Slider Contrast -->
  <label><button id="toggleContrast">âš™ï¸ Atur Kontras</button>
  <input type="range" id="contrastSlider" min="0" max="200" value="100" style="display:none; width: 100%;">
</label>

<div id="urlInputWrapper" style="display:none; flex-direction: column; gap: 0.5em;">
  <label>
    <span style="font-size: 0.9em;">URL Gambar:</span>
    <input type="url" id="backgroundUrl" placeholder="https://..." style="width: 100%;">
  </label>
  <button id="applyUrlButton" class="button">OK</button>
</div>

<label>
  <select id="colorTarget">
    <option value="quran-text">Warna Ayat</option>
    <option value="translation">Warna Terjemah</option>
    <option value="surah-info">Warna Info Surah</option>
  </select>
</label>

<label>
  <input type="color" id="colorPicker" value="#ffffff">
</label>

<div class="button-wrapper">
  <button id="applyColor">Konfirmasi Warna</button>
</div>

  <div class="button-wrapper">
  <button id="saveImageTrigger">Download Gambar</button>
</div>

<div id="saveSizeOptions" style="display:none; gap: 0.5em; flex-wrap: wrap;">
  <button class="save-option" data-size="1080">1080x1080</button>
  <button class="save-option" data-size="2048">2048x2048</button>
  <button class="save-option" data-size="4096">4096x4096</button>
</div>

<!-- Pilihan Font Terjemah -->
<label><select id="translationFontSelect">
    <option value="https://fonts.gstatic.com/s/opensans/v28/mem8YaGs126MiZpBA-UFVZ0e.ttf">Open Sans</option>
    <option value="https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxP.ttf">Roboto</option>
    <option value="https://fonts.gstatic.com/s/nunito/v25/XRXV3I6Li01BKofA-seUbQ.ttf">Nunito</option>
  </select>
</label>

<!-- Ukuran Font Terjemah -->

<!-- Ukuran Font Ayat -->
<label>
  Ukuran Ayat:
  <input type="range" id="quranFontSize" min="18" max="72" value="36">
</label>
  
<label>
  Ukuran Terjemah:
  <input type="range" id="translationFontSize" min="10" max="48" value="20">
</label>

<!-- Ukuran Font Info Surah -->
<label>
  Ukuran Info Surah:
  <input type="range" id="infoFontSize" min="10" max="32" value="16">
</label>
  
</div>


  
<!-- ğŸ”¥ Loader Overlay -->
<div id="loaderOverlay" style="
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(255,255,255,0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  display: none;">
  <div style="
    border: 8px solid #f3f3f3;
    border-top: 8px solid #4cafef;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    animation: spin 1s linear infinite;">
  </div>
</div>

<style>
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
</style>

<script>

const backgroundSelect = document.getElementById("backgroundSelect");
const backgroundUpload = document.getElementById("backgroundUpload");
const backgroundUrl = document.getElementById("backgroundUrl");
const pagesContainer = document.getElementById("pages");

const contrastSlider = document.getElementById("contrastSlider");
const toggleContrast = document.getElementById("toggleContrast");

// Dropdown Gambar
backgroundSelect.addEventListener("change", () => {
  const bg = backgroundSelect.value;
  if (bg) {
    pagesContainer.style.backgroundImage = `url('${bg}')`;
    backgroundUrl.value = "";
  } else {
    pagesContainer.style.backgroundImage = "none";
  }
  saveHistory();
});

// Upload Gambar
backgroundUpload.addEventListener("change", () => {
  const file = backgroundUpload.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      pagesContainer.style.backgroundImage = `url('${e.target.result}')`;
      backgroundSelect.value = "";
      backgroundUrl.value = "";
    };
    reader.readAsDataURL(file);
  }
});

// Gambar dari URL (tekan Enter)
backgroundUrl.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    const url = backgroundUrl.value.trim();
    if (url) {
      pagesContainer.style.backgroundImage = `url('${url}')`;
      backgroundSelect.value = "";
      saveHistory();
    }
  }
});

// Toggle kontras: muncul/sembunyi slider
toggleContrast.addEventListener("click", () => {
  const isVisible = contrastSlider.style.display === "block";
  contrastSlider.style.display = isVisible ? "none" : "block";
  if (!isVisible) contrastSlider.value = 100; // reset ke normal saat muncul
  pagesContainer.style.filter = `contrast(${contrastSlider.value / 100})`;
});

// Ubah kontras saat slider digeser
contrastSlider.addEventListener("input", () => {
  const contrastValue = 1 + ((contrastSlider.value - 100) / 100); 
  pagesContainer.style.filter = `contrast(${contrastValue})`;
});



  
  
function saveHistory() {
  const history = {
    surah: surahSelect.value,
    ayah: ayahSelect.value,
    wordStart: wordStart.value,
    wordEnd: wordEnd.value,
    translation: wordTranslationId.value,
    background: backgroundSelect.value,
    version: currentVersion
  };
  localStorage.setItem('quranHistory', JSON.stringify(history));
}

function loadHistory() {
  const history = JSON.parse(localStorage.getItem('quranHistory') || '{}');
  if (history.surah) surahSelect.value = history.surah;
  if (history.version) currentVersion = history.version;
  if (history.background) backgroundSelect.value = history.background;
  document.getElementById("pages").style.backgroundImage = history.background ? `url('${history.background}')` : "none";
  return history;
}

const loaderOverlay = document.getElementById('loaderOverlay');
function showLoader() { loaderOverlay.style.display = 'flex'; }
function hideLoader() { loaderOverlay.style.display = 'none'; }

const translationLanguageMap = { "20": "en", "33": "id" };

const surahList = {
  1:["Al-FÄtiá¸¥ah"], 2:["Al-Baqarah"], 3:["Ä€l Ê¿ImrÄn"], 4:["An-NisÄÊ¾"],
  5:["Al-MÄÊ¾idah"], 6:["Al-AnÊ¿Äm"], 7:["Al-AÊ¿rÄf"], 8:["Al-AnfÄl"],
  9:["At-Tawbah"], 10:["YÅ«nus"], 11:["HÅ«d"], 12:["YÅ«suf"], 13:["Ar-RaÊ¿d"],
  14:["IbrÄhÄ«m"], 15:["Al-á¸¤ijr"], 16:["An-Naá¸¥l"], 17:["Al-IsrÄÊ¾"],
  18:["Al-Kahf"], 19:["Maryam"], 20:["á¹¬Ä-HÄ"], 21:["Al-AnbiyÄÊ¾"],
  22:["Al-á¸¤ajj"], 23:["Al-MuÊ¾minÅ«n"], 24:["An-NÅ«r"], 25:["Al-FurqÄn"],
  26:["Ash-ShuÊ¿arÄÊ¾"], 27:["An-Naml"], 28:["Al-Qaá¹£aá¹£"], 29:["Al-Ê¿AnkabÅ«t"],
  30:["Ar-RÅ«m"], 31:["LuqmÄn"], 32:["As-Sajdah"], 33:["Al-Aá¸¥zÄb"],
  34:["SabaÊ¾"], 35:["FÄá¹­ir"], 36:["YÄ-SÄ«n"], 37:["As-á¹¢ÄffÄt"],
  38:["á¹¢Äd"], 39:["Az-Zumar"], 40:["GhÄfir"], 41:["Fuá¹£á¹£ilat"], 42:["Ash-ShÅ«rÄ"],
  43:["Az-Zukhruf"], 44:["Ad-DukhÄn"], 45:["Al-JÄthiyah"], 46:["Al-Aá¸¥qÄf"],
  47:["Muá¸¥ammad"], 48:["Al-Fatá¸¥"], 49:["Al-á¸¤ujurÄt"], 50:["QÄf"],
  51:["Adh-DhÄriyÄt"], 52:["Aá¹­-á¹¬Å«r"], 53:["An-Najm"], 54:["Al-Qamar"],
  55:["Ar-Raá¸¥mÄn"], 56:["Al-WÄqiÊ¿ah"], 57:["Al-á¸¤adÄ«d"], 58:["Al-MujÄdilah"],
  59:["Al-á¸¤ashr"], 60:["Al-Mumtaá¸¥anah"], 61:["Aá¹£-á¹¢aff"], 62:["Al-JumuÊ¿ah"],
  63:["Al-MunÄfiqÅ«n"], 64:["At-TaghÄbun"], 65:["Aá¹­-á¹¬alÄq"], 66:["At-Taá¸¥rÄ«m"],
  67:["Al-Mulk"], 68:["Al-Qalam"], 69:["Al-á¸¤Äqqah"], 70:["Al-MaÊ¿Ärij"],
  71:["NÅ«á¸¥"], 72:["Al-Jinn"], 73:["Al-Muzzammil"], 74:["Al-Muddaththir"],
  75:["Al-QiyÄmah"], 76:["Al-InsÄn"], 77:["Al-MursalÄt"], 78:["An-NabaÊ¾"],
  79:["An-NÄziÊ¿Ät"], 80:["Ê¿Abasa"], 81:["At-TakwÄ«r"], 82:["Al-Infiá¹­Är"],
  83:["Al-Muá¹­affifÄ«n"], 84:["Al-InshiqÄq"], 85:["Al-BurÅ«j"], 86:["Aá¹­-á¹¬Äriq"],
  87:["Al-AÊ¿lÄ"], 88:["Al-GhÄshiyah"], 89:["Al-Fajr"], 90:["Al-Balad"],
  91:["Ash-Shams"], 92:["Al-Layl"], 93:["Aá¸-á¸Œuá¸¥Ä"], 94:["Ash-Shará¸¥"],
  95:["At-TÄ«n"], 96:["Al-Ê¿Alaq"], 97:["Al-Qadr"], 98:["Al-Bayyinah"],
  99:["Az-Zalzalah"], 100:["Al-Ê¿Ä€diyÄt"], 101:["Al-QÄriÊ¿ah"], 102:["At-TakÄthur"],
  103:["Al-Ê¿Aá¹£r"], 104:["Al-Humazah"], 105:["Al-FÄ«l"], 106:["Quraysh"],
  107:["Al-MÄÊ¿Å«n"], 108:["Al-Kawthar"], 109:["Al-KÄfirÅ«n"], 110:["An-Naá¹£r"],
  111:["Al-Masad"], 112:["Al-IkhlÄá¹£"], 113:["Al-Falaq"], 114:["An-NÄs"]
};

const surahSelect = document.getElementById("surahSelect");
const ayahSelect = document.getElementById("ayahSelect");
const wordStart = document.getElementById("wordStart");
const wordEnd = document.getElementById("wordEnd");
const wordTranslationId = document.getElementById("wordTranslationId");
let currentVersion = 'v1';
let words = [];
let initialLoad = true;

function setVersion(v) {
  currentVersion = v;
  loadAyat();
}

for (let i in surahList) {
  const [name] = surahList[i];
  surahSelect.appendChild(new Option(`${i}. ${name}`, i));
}

surahSelect.addEventListener("change", () => { updateAyahDropdown(); saveHistory(); });
ayahSelect.addEventListener("change", () => { loadAyat(); saveHistory(); });
wordStart.addEventListener("change", () => {
  const startVal = +wordStart.value;
  wordEnd.innerHTML = "";
  for (let i = startVal; i <= words.length; i++) wordEnd.appendChild(new Option(i, i));
  wordEnd.value = startVal;
  loadAyat();
  saveHistory();
});
wordEnd.addEventListener("change", () => { loadAyat(); saveHistory(); });
wordTranslationId.addEventListener("change", () => {
  const value = wordTranslationId.value;

  if (value.startsWith("qenc:")) {
    const translationKey = value.split(":")[1];
    loadQuranEncTranslation(translationKey);
  } else {
    loadAyat();
  }

  saveHistory();
});

async function updateAyahDropdown() {
  const s = surahSelect.value;
  const res = await fetch(`https://api.quran.com/api/v4/chapters/${s}`);
  const json = await res.json();
  const max = json.chapter.verses_count;
  ayahSelect.innerHTML = "";
  for (let i = 1; i <= max; i++) ayahSelect.appendChild(new Option(`Ayat ${i}`, i));
  ayahSelect.value = 1;
  loadAyat();
}

<script>
  async function loadAyat() {
    const surahNumber = parseInt(surahSelect.value);
    const ayahNumber = parseInt(ayahSelect.value);

    // Bersihkan area sebelum render
    pages.innerHTML = "";

    // Ambil data ayat Arab
    const arabicText = await getArabicText(surahNumber, ayahNumber);

    const div = document.createElement("div");
    div.className = "page-container";

    const arabicDiv = document.createElement("div");
    arabicDiv.className = "arabic-text";
    arabicDiv.innerText = arabicText;
    makeDraggable(arabicDiv);
    div.appendChild(arabicDiv);

    // Ambil Terjemahan per ayat
    const translationKey = translationSelect?.value;
    if (translationKey) {
      const res = await fetch(`https://quranenc.com/api/v1/translation/aya/${translationKey}/${surahNumber}/${ayahNumber}`);
      const data = await res.json();
      const translation = data?.result?.translation || "";

      const transDiv = document.createElement("div");
      transDiv.className = "translation";
      transDiv.contentEditable = true;
      transDiv.innerText = translation;
      makeDraggable(transDiv);
      div.appendChild(transDiv);
    }

    // Ambil Terjemah Per Kata
    const wordTranslationId = document.getElementById("wordTranslationId");
    const langCode = wordTranslationId?.value || "";

    if (langCode) {
      try {
        const wordRes = await fetch(`https://api.quran.com/api/v4/verses/by_key/${surahNumber}:${ayahNumber}?words=true&language=${langCode}&translations=33`);
        const wordData = await wordRes.json();
        const words = wordData?.verse?.words || [];

        const wordTranslations = words.map(w => w.translation?.text || "");
        const transDiv = document.createElement("div");
        transDiv.className = "translation";
        transDiv.contentEditable = true;
        transDiv.innerText = wordTranslations.join(" ");
        makeDraggable(transDiv);
        div.appendChild(transDiv);
      } catch (e) {
        console.error("Gagal ambil terjemah perkata:", e);
      }
    }

    pages.appendChild(div);
  }
</script>


    div.style.display = "block";
    requestAnimationFrame(() => div.style.opacity = "1");
  } catch (e) {
    alert("Gagal memuat ayat: " + e.message);
  } finally {
    hideLoader();
  }
}

const last = loadHistory();
updateAyahDropdown().then(() => {
  if (last.ayah) ayahSelect.value = last.ayah;
  if (last.wordStart) wordStart.value = last.wordStart;
  if (last.wordEnd) wordEnd.value = last.wordEnd;
  if (last.translation) wordTranslationId.value = last.translation;
});
  
</script>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dom-to-image@2.6.0/src/dom-to-image.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

  <script>

const saveImageTrigger = document.getElementById("saveImageTrigger");
const saveSizeOptions = document.getElementById("saveSizeOptions");

saveImageTrigger.addEventListener("click", () => {
  saveSizeOptions.style.display = "flex";
});

document.querySelectorAll(".save-option").forEach(btn => {
  btn.addEventListener("click", () => {
    const size = parseInt(btn.dataset.size);
    saveImageAsPng(size);
    saveSizeOptions.style.display = "none";
  });
});

function saveImageAsPng(size = 1080) {
  const node = document.getElementById("pages");
  const s = surahSelect.value;
  const a = ayahSelect.value;
  const surahName = surahList[s][0].replace(/[^a-zA-Z0-9]/g, "-");
  const filename = `${surahName}-${a}.png`;

  domtoimage.toBlob(node, {
    width: size,
    height: size,
    style: {
      transform: "scale(1)",
      transformOrigin: "top left",
      width: size + "px",
      height: size + "px"
    }
  }).then(function (blob) {
    window.saveAs(blob, filename);
  });
}

    
    document.getElementById("applyColor").addEventListener("click", () => {
  const target = document.getElementById("colorTarget").value;
  const color = document.getElementById("colorPicker").value;
  const elements = document.querySelectorAll(`.${target}`);
  elements.forEach(el => {
    el.style.color = color;
  });
});

// Trigger input file saat tombol diklik
document.getElementById("uploadTrigger").addEventListener("click", function () {
  document.getElementById("backgroundUpload").click();
});

const showUrlInput = document.getElementById("showUrlInput");
const urlInputWrapper = document.getElementById("urlInputWrapper");
const applyUrlButton = document.getElementById("applyUrlButton");

showUrlInput.addEventListener("click", () => {
  urlInputWrapper.style.display = "flex";
});

applyUrlButton.addEventListener("click", () => {
  const url = document.getElementById("backgroundUrl").value.trim();
  if (url) {
    pagesContainer.style.backgroundImage = `url('${url}')`;
    backgroundSelect.value = "";
    saveHistory();
  }
});

const translationFontSelect = document.getElementById("translationFontSelect");
const translationFontSize = document.getElementById("translationFontSize");

function loadFontFromUrl(fontUrl, fontName) {
  const style = document.createElement("style");
  style.textContent = `
    @font-face {
      font-family: '${fontName}';
      src: url('${fontUrl}');
    }
  `;
  document.head.appendChild(style);
  document.fonts.load(`1em ${fontName}`);
}

translationFontSelect.addEventListener("change", () => {
  const fontUrl = translationFontSelect.value;
  const fontName = "customTranslationFont";
  loadFontFromUrl(fontUrl, fontName);
  document.querySelectorAll(".translation").forEach(el => {
    el.style.fontFamily = fontName;
  });
});

 document.getElementById("quranFontSize").addEventListener("input", e => {
   document.querySelectorAll(".quran-v1, .quran-v2").forEach(el => {
     el.style.fontSize = `${e.target.value}px`;
  });
});

document.getElementById("translationFontSize").addEventListener("input", e => {
  document.querySelectorAll(".translation").forEach(el => {
    el.style.fontSize = `${e.target.value}px`;
  });
});

document.getElementById("infoFontSize").addEventListener("input", e => {
  document.querySelectorAll(".surah-info").forEach(el => {
    el.style.fontSize = `${e.target.value}px`;
  });
});

async function loadQuranEncTranslation(translationKey) {
  const surah = document.getElementById("surahSelect").value;
  const ayah = document.getElementById("ayahSelect").value;
  const url = `https://quranenc.com/api/v1/translation/aya/${translationKey}/${surah}/${ayah}`;

  try {
    // Bersihkan terjemahan lama
    document.querySelectorAll(".translation").forEach(el => el.remove());

    const res = await fetch(url);
    const data = await res.json();
    const translationText = data.translation;

    const container = document.querySelector(".page-container");
    if (!container) {
      console.error("page-container tidak ditemukan");
      return;
    }

    const transDiv = document.createElement("div");
    transDiv.className = "translation";
    transDiv.contentEditable = true;
    transDiv.innerText = translationText;
    transDiv.setAttribute("draggable", "false");
    transDiv.style.userSelect = "text";
    transDiv.style.fontSize = document.getElementById("translationFontSize").value + "px";

    container.appendChild(transDiv);
  } catch (err) {
    console.error("Gagal mengambil terjemahan QuranEnc:", err);
  }
}

    
</script>
  
</body>
</html>
